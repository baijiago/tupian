# remove.bg 接口（MCP）重装与联调历史

> 范围：本次仅针对 remove.bg 抠图接口的“重新安装与启停联调”过程总结（用户口径：装 mcp）

## 背景
- 现象：前端上传正常，但接口偶发连接失败，用户希望“重新装一下并重启服务”。
- 目标：一键清理依赖、重装、重启服务，确保 /health 与去背景流程恢复可用。

## 时间线与操作
- 2025-11-06 设定 API 密钥
  - 文件：.env
  - 内容：REMOVE_BG_API_KEY=******9bgXp（用户提供）PORT=8787
  - 意图：后端通过服务端环境变量向 remove.bg 鉴权，前端不暴露密钥。

- 2025-11-06 重新安装依赖
  - 操作：
pm install（或 
pm ci 若有 lockfile）
  - 备注：出现 multer@1.x 弃用/安全告警，后续建议升级 2.x。

- 2025-11-06 停止旧服务并重启
  - 停止：查找并结束旧的 
ode server/index.js 进程
  - 启动：
ode server/index.js
  - 健康检查：GET /health → {"ok":true}

- 2025-11-06 页面联调
  - 地址：http://localhost:8787/remove-bg/
  - 用户上传本地图片 → 点击“去背景” → 返回抠图结果并可下载
  - 结果：成功

## 本次涉及的变更点（与接口重装相关）
- 环境：.env 中写入/确认 REMOVE_BG_API_KEY 与端口
- 依赖：重新安装 xios/express/multer/form-data/dotenv 等
- 运行：停止旧进程，启动新进程，并验证健康检查

## 与前端相关的已知修复（辅助联调成功）
- 新增可见“选择文件”按钮，保证能唤起文件选择框
- 拖拽文件夹时提示“请拖拽具体图片文件（不支持文件夹）”
- 背景图片 URL 校验：仅允许 http/https
- 上传校验：类型 image/* 或常见扩展名，大小 ≤ 25MB

## 验证清单
- GET /health 返回 {"ok":true}
- 页面可选择图片且能预览
- 点击“去背景”成功返回图片数据；可下载 原名-no-bg.(png|webp|jpg)

## 风险与后续建议
- 依赖：multer@1.x 有安全告警，建议择期升级 2.x 并回归测试上传逻辑
- 稳定性：为应对接口配额/超时，后端可加入超时、重试与更清晰的错误提示
- 监控：可添加简单请求日志（脱敏）与错误堆栈记录，便于排查

## 快速回滚
- 如重装后异常，可：
  1) 还原 .env 旧值；
  2) 删除 
ode_modules 后重新 
pm install；
  3) 重启 server/index.js 并检查 /health。
