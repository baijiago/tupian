# ?????????????2025-11-11?

????????????????????????????????????????????

## ?????
- ???????????? Vercel serverless `api/generate.js` ???????
- ??????????????????Vercel ??/????? `POST /api/remove-bg` ? 404?
- ??????? `server/index.js`?Express??????????????????

## ????
- Vercel ??????????? Express ???`server/index.js`????? `api/*.js` ??? serverless ???
- ?????? `/api/remove-bg` ??? serverless ??? rewrite??????? 404?

## ????
- ????????serverless proxy??? multipart ? remove.bg ??????????
  - `api/remove-bg.js:1`
- ?? Vercel ?????? `/api/remove-bg` ????? serverless ????
  - `vercel.json:3`
- ????????????????????? `.env` ?? `ARK_API_KEY`??????????????

## ???
- ?????????Vercel??
  - `REMOVE_BG_API_KEY`????
    - ???Preview??????Production?????
- ?? `.env`?
  - `REMOVE_BG_API_KEY=<???>`???????????
  - `PORT=8790`??? Express ???
  - `ARK_API_KEY=<????????>`????????????

## ????
- ???????`node server/index.js`??? 8790?
- ?????
  - ???`remove-bg/{9C0E4500-787B-4BE5-83C3-E69C041F972C}.png`
  - ???`POST http://127.0.0.1:8790/api/remove-bg`????`image_file=@...`?`size=preview`
  - ???HTTP 200?`Content-Type: image/png`???? `out-no-bg.png`

## ?????Vercel?
- ?????`baijias-projects/tupian`???? `.vercel`?
- ?????
  - Preview?`REMOVE_BG_API_KEY` ???
  - Production?`REMOVE_BG_API_KEY` ???
- ???????
  - ?????`https://tupian-ozjyqn60a-baijias-projects.vercel.app`
  - ?????? Preview Protection????????? 401??????????
- ?????????? `socket hang up`?CLI ????????????????????? CLI?

## ??????
- ???????? 401 ???Preview Protection ?????????? Bypass Token?
- ??????????????serverless ??? rewrite ????????????

## ???????
1. ??????????????
   - ????????? Vercel ???????????????? `/remove-bg/` ???????
   - Bypass Token ????? Settings ? Security ??? Preview Protection ? Bypass URL?? token ?????? `x-vercel-protection-bypass: <token>` ???????
2. ???????
   - ? Vercel ????? ?Deploy to Production??????????? `/remove-bg/` ?????? `POST /api/remove-bg` ?????

## ??????
- 401 Unauthorized?????????????????????????? Bypass Token?
- 500 `server_missing_api_key`??????? `REMOVE_BG_API_KEY`?? Vercel ??????????????
- 400 `image_file is required`????????/????????????????/??/??????? `image_file` ???
- ????????? ? 25MB?

## ??????
- ??? `/api/remove-bg` ?????? `remove-bg/`?????????

## TODO????
- `server.js` ???? `resolvePath`????????????????????????????????
- ???????????????? URL ? `/api/remove-bg` ? CI ??????

## ???????
- ???`api/remove-bg.js:1`
- ???`vercel.json:3`
- ???`remove-bg/index.html:1`
- ?????`server/index.js:1`
- ???`.env:1`

